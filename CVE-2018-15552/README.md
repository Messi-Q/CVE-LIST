
# CVE-2018-15552: Bad Randomness in TheEthereumLottery

## Abstract We found a vulnerability in smart contract of ‘TheEthereumLottery’ which is an Ethereum lottery game. This game generates random numbers `maxTickets` with their own permutations which is easily predictable. Also, the developer use this variable with a `private` visibility. However, all variables in blockchain is not secret, so it can easily leaked.

## Details
‘TheEthereumLottery’ is a Ethereum lottery game. You can buy a lottery ticket with 0.0101 ether by clicking buttons of the website and automatically entered the lottery.

![](./images/figure1.png)
  *Figure 1. TheEthereumLottery Dapp Website*

  This lottery increases the variable `numTickets` when people buy tickets. When `numTickets` reaches the random number `maxTickets`, the person who bought the ticket wins.(Line 78)

  ![](./images/figure2.png)
  *Figure 2. AddTicket() function*

  TheEthereumLottery developer made `maxTickets` with own permutations. However, maxTickets are not random and predictable (Line 106-110). As you can see in Line 105, the developer intended to make `maxTickets` unpredictable.
  ![](./images/figure3.png)
  *Figure 3. PayWinner() function*

  Also, it can be accessed by "getStorageAt" function and the attacker can know which is the proper time to buy ticket.

## Exploit

  Below figure is the result of getStorageAt function. We can leak the private variable `maxTickets` easily.

  ![](./images/figure4.png)
  *Figure 4. The Result of getStorageAt() function*

## Conclusion

  Nothing is secret in the ethereum blockchain. Although developers use the `private` visibility in the variable, someone can check the contents of the variable. Also, solidity developers should carefully audit their code whether they use bad random number.
